(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{14:function(e,t,n){function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.getPrototypeOf||function(e){return e.__proto__})(e)}for(var l=n(75),c=n(163),u=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=i(this,s(t).call(this,e,n,r))).pausedSpending=!0,o}var n,r,l;return n=t,(r=[{key:"getRandomReceiver",value:function(){var e=this,t=m.filter(function(t){return t.wallet.address!==e.wallet.address});return t[Math.floor(Math.random()*t.length)].wallet.address}},{key:"tick",value:function(){if(!(this.state[this.wallet.address].balance<10||this.pausedSpending)&&Math.random()<.01){var e=this.generateTx(this.getRandomReceiver(),10);this.transactions.push(e),this.applyTransaction(e),this.network.broadcast(this.pid,e)}}}])&&a(n.prototype,r),l&&a(n,l),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");o(e.prototype,t&&t.prototype),t&&o(e,t)}(t,e),t}(n(162).Node),f=[],d={},p=new c(15,0),h=0;h<4;h++)f.push(l.createIdentity()),d[f[h].address]={balance:100,nonce:0};for(var m=[],y=0;y<4;y++)m.push(new u(f[y],JSON.parse(JSON.stringify(d)),p)),p.connectPeer(m[y],2);e.exports={nodes:m,network:p}},15:function(e,t,n){function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,n){return(s="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function l(e){return(l=Object.getPrototypeOf||function(e){return e.__proto__})(e)}for(var c=n(75),u=n(163),f=function(e){function t(e,n,r,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=i(this,l(t).call(this,e,n,r,o))).pausedSpending=!0,a}var n,r,c;return n=t,(r=[{key:"getRandomReceiver",value:function(){var e=this,t=y.filter(function(t){return t.wallet.address!==e.wallet.address});return t[Math.floor(Math.random()*t.length)].wallet.address}},{key:"tick",value:function(){s(l(t.prototype),"tick",this).call(this),this.state[this.wallet.address].balance<10||this.pausedSpending||Math.random()<.01&&this.sendTx(this.getRandomReceiver(),10)}}])&&a(n.prototype,r),c&&a(n,c),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");o(e.prototype,t&&t.prototype),t&&o(e,t)}(t,e),t}(n(230)),d=[],p={},h=new u(15,0),m=0;m<5;m++)d.push(c.createIdentity()),p[d[m].address]={balance:100,nonce:0};for(var y=[],v=0;v<5;v++)y.push(new f(d[v],JSON.parse(JSON.stringify(p)),h,15)),h.connectPeer(y[v],2);e.exports={nodes:y,network:h}},162:function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(75);function a(e){return o.hash.keccak256(JSON.stringify(e))}var i=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wallet=t,this.pid=t.address,this.network=r,this.state=n,this.transactions=[],this.invalidNonceTxs={},this.setColor()}var t,n,i;return t=e,(n=[{key:"onReceive",value:function(e){this.transactions.includes(e)||(this.transactions.push(e),this.applyTransaction(e),this.network.broadcast(this.pid,e),this.applyInvalidNonceTxs(e.contents.from))}},{key:"applyInvalidNonceTxs",value:function(e){var t=this.state[e].nonce;e in this.invalidNonceTxs&&t in this.invalidNonceTxs[e]&&(this.applyTransaction(this.invalidNonceTxs[e][t]),delete this.invalidNonceTxs[e][t],this.applyInvalidNonceTxs(e))}},{key:"tick",value:function(){}},{key:"generateTx",value:function(e,t){var n={type:"send",amount:t,from:this.wallet.address,to:e,nonce:this.state[this.wallet.address].nonce};return{contents:n,sig:o.sign(this.wallet.privateKey,a(n))}}},{key:"setColor",value:function(){this.color="#"+o.hash.keccak256(JSON.stringify(this.state)).substr(-6)}},{key:"applyTransaction",value:function(e){if(o.recover(e.sig,a(e.contents))!==e.contents.from)throw new Error("Invalid signature!");if(e.contents.to in this.state||(this.state[[e.contents.to]]={balance:0,nonce:0}),e.contents.nonce!==this.state[[e.contents.from]].nonce)return e.contents.from in this.invalidNonceTxs||(this.invalidNonceTxs[e.contents.from]={}),void(this.invalidNonceTxs[e.contents.from][e.contents.nonce]=e);if("send"!==e.contents.type)throw new Error("Invalid transaction type!");this.state[[e.contents.from]].balance-e.contents.amount<0||(this.state[[e.contents.from]].balance-=e.contents.amount,this.state[[e.contents.to]].balance+=e.contents.amount,this.state[[e.contents.from]].nonce+=1,this.setColor())}}])&&r(t.prototype,n),i&&r(t,i),e}();e.exports={Node:i,getTxHash:a}},163:function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(50),a=n(96),i=n(328),s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);a.randomNormal.source(i("a22ebc7c488a3a47"))(t,2*t/5);this.agents=[],this.latencyDistribution=function(){return Math.floor(a.randomUniform(2*t/5,t)())},this.time=0,this.messageQueue={},this.peers={},this.packetLoss=n}var t,n,s;return t=e,(n=[{key:"connectPeer",value:function(e,t){e.network=this;var n=o.shuffle(this.agents);this.agents.push(e),this.peers[e.pid]=[];var r=!0,a=!1,i=void 0;try{for(var s,l=n.slice(0,t)[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;this.peers[e.pid].push(c),this.peers[c.pid].push(e)}}catch(e){a=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}}},{key:"broadcast",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var a,i=this.peers[e][Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var s=a.value;this.broadcastTo(e,s,t)}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}}},{key:"broadcastTo",value:function(e,t,n){var r=this.time+this.latencyDistribution();r in this.messageQueue||(this.messageQueue[r]=[]),this.messageQueue[r].push({sender:e,sentTime:this.time,recipient:t,recvTime:r,message:n})}},{key:"tick",value:function(){if(this.time in this.messageQueue){var e=!0,t=!1,n=void 0;try{for(var r,o=this.messageQueue[this.time][Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value,i=a.recipient,s=a.message;Math.random()>this.packetLoss&&i.onReceive(s)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}delete this.messageQueue[this.time]}var l=!0,c=!1,u=void 0;try{for(var f,d=this.agents[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){f.value.tick()}}catch(e){c=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}this.time+=1}},{key:"run",value:function(e){for(var t=0;t<e;t++)this.tick()}}])&&r(t.prototype,n),s&&r(t,s),e}();e.exports=s},204:function(e,t,n){},228:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(20),i=n.n(a),s=(n(440),n(204),n(14)),l=n(94),c=n(138),u=n(224),f=n.n(u),d=function(e){var t=e.paused,n=e.onPause,r=e.onPauseTxs,a=(e.pausedTxs,e.togglePopup);e.adjustSpeed;return o.a.createElement("div",{id:"Controls"},o.a.createElement(l.a,{onClick:n},t?o.a.createElement(c.a,{glyph:"play"}):o.a.createElement(c.a,{glyph:"pause"})),o.a.createElement("div",{id:"txToggle"},"Send Transactions ",o.a.createElement(f.a,{onChange:r})),o.a.createElement(l.a,{onClick:a},o.a.createElement(c.a,{glyph:"question-sign"})))},p=n(50),h=n.n(p);function m(e){return(m="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==m(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.getPrototypeOf||function(e){return e.__proto__})(e)}var w=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=g(this,b(t).call(this,e))).invalidNonceTxs=[],n}var n,r,a;return n=t,(r=[{key:"updateInvalidNonceTxs",value:function(){var e=this.invalidNonceTxs,t=this.props.node,n=[],r=[];Object.keys(t.invalidNonceTxs).forEach(function(e,r){Object.keys(t.invalidNonceTxs[e]).forEach(function(r,o){var a=t.invalidNonceTxs[e][r];n.push(a.contents)})});var o=!0,a=!1,i=void 0;try{for(var s,l=function(){var e=s.value;n.find(function(t){return h.a.isEqual(t,e)})&&r.push(e)},c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0)l()}catch(e){a=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw i}}for(var u=function(){var e=n[f];r.find(function(t){return h.a.isEqual(e,t)})||r.push(e)},f=0;f<n.length;f++)u();this.invalidNonceTxs=r}},{key:"clicked",value:function(e,t){e(t)}},{key:"render",value:function(){var e=this,t=this.props,n=t.node,r=t.icons,a=t.showState;this.updateInvalidNonceTxs();var i=Object.keys(n.state).map(function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,e.substring(0,5)),o.a.createElement("td",null,n.state[e].balance),o.a.createElement("td",null,n.state[e].nonce))}),s=this.invalidNonceTxs.map(function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,e.from.substring(0,5)),o.a.createElement("td",null,e.to.substring(0,5)),o.a.createElement("td",null,e.amount),o.a.createElement("td",null,e.nonce))}),l=o.a.createElement("div",{style:this.invalidNonceTxs.length?{}:{display:"none"}},o.a.createElement("p",null,"Invalid Nonce Transactions"),o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"From"),o.a.createElement("th",null,"To"),o.a.createElement("th",null,"Amount"),o.a.createElement("th",null,"Nonce")),s))),c=Number.parseInt(n.color.slice(1),16),u="white";return(.299*(c>>16&255)+.587*(c>>8&255)+.114*(255&c))/255>.5&&(u="black"),o.a.createElement("div",{className:"Ledger",id:"ledger-"+n.pid,style:{backgroundColor:n.color,color:u}},o.a.createElement("img",{alt:"Gerbil",src:r[n.pid],width:"30"}),o.a.createElement("span",{className:"ledger-title"}," "+n.pid.substring(0,5)),o.a.createElement("button",{className:"LedgerMinimizeButton",onClick:function(t){return e.clicked(a,n)}},o.a.createElement("div",{className:"LedgerMinimizeButtonIcon",style:{backgroundColor:u}})),o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Address"),o.a.createElement("th",null,"Balance"),o.a.createElement("th",null,"Nonce"),o.a.createElement("th",null,"            ")),i)),l)}}])&&v(n.prototype,r),a&&v(n,a),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");y(e.prototype,t&&t.prototype),t&&y(e,t)}(t,e),t}(r.Component),k=function(e){var t=e.nodes,n=e.icons,r=e.showState;return o.a.createElement("div",{id:"Ledgers"},Object.keys(t).map(function(e,a){return o.a.createElement(w,{key:e,node:t[e],icons:n,showState:r})}))},E=n(41),S=n(31),x=n(40),T=n(91),O=function(e){var t=e.show,n=e.handleClose,r=o.a.createElement(E.a,{id:"modal-popover",title:""},"For the technical people: We took the first 6 hexadecimal characters of the Keccak-256 hash of the state and turned it into a hex color!"),a=o.a.createElement(E.a,{id:"modal-popover",title:"Spend"},'Clicking "Spend" will make the selected node generate and propagate a transaction sending $10 to a random node.'),i=o.a.createElement(E.a,{id:"modal-popover",title:"Double Spend"},'Clicking "Double Spend" will make the selected node generate and selectively propagate two transactions each sending $10 to a different peer.',o.a.createElement("br",null)),s=o.a.createElement(E.a,{id:"modal-popover",title:"Resume Transactions"},'Switching on "Resume Transactions" will make all nodes randomly generate and send transactions.',o.a.createElement("br",null));return o.a.createElement(S.a,{show:t,onHide:n},o.a.createElement(S.a.Header,{closeButton:!0},o.a.createElement(S.a.Title,null,"Instructions")),o.a.createElement(S.a.Body,null,o.a.createElement("h4",null,"What is this?"),o.a.createElement("p",null,"This is an interactive network simulation designed as a part of Chapter 2 of "," ",o.a.createElement("a",{href:"https://cryptoeconomics.study/"},"Cryptoeconomics.study"),". To best understand the double spend problem, here is Ethereum Researcher Karl Floersch's explanation in section 2.2 of the course:",o.a.createElement(T.a,{videoId:"k6JVGR7Jx0A",opts:{height:"300",width:"550",playerVars:{autoplay:0}}})),o.a.createElement("h4",null,"How do you send a transaction?"),o.a.createElement("p",null,"Click on a node to either "," ",o.a.createElement(x.a,{overlay:a},o.a.createElement("a",{href:""},"Spend"))," "," or "," ",o.a.createElement(x.a,{overlay:i},o.a.createElement("a",{href:""},"Double Spend"))," ",". You can also toggle the "," ",o.a.createElement(x.a,{overlay:s},o.a.createElement("a",{href:""},"Resume Transactions"))," ","switch."),o.a.createElement("h4",null,"Why is my network graph so small?"),o.a.createElement("p",null,"To increase the size of the network graph, hover over it and scroll upwards. You can also reposition the graph by dragging it around."),o.a.createElement("h4",null,"What do the colors mean?"),o.a.createElement("p",null,"The color of each node "," ",o.a.createElement(x.a,{overlay:r},o.a.createElement("a",{href:""},"represents"))," "," the state of that node's ledger.")),o.a.createElement(S.a.Footer,null,o.a.createElement(l.a,{onClick:n},"Close")))};function N(e){return(N="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e){return(P=Object.getPrototypeOf||function(e){return e.__proto__})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var R=function(e){function t(e){var n,r,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,(n=!(o=P(t).call(this,e))||"object"!==N(o)&&"function"!==typeof o?C(r):o).clicked=n.clicked.bind(C(C(n))),n}var n,r,a;return n=t,(r=[{key:"clicked",value:function(e,t){e(t)}},{key:"render",value:function(){var e=this,t=this.props,n=t.isSelected,r=t.icons,a=t.node,i=t.showState,s={height:"45px",width:"45px",backgroundColor:a.color,borderRadius:"50%",display:n?"none":"flex"};return a?o.a.createElement("div",{onClick:function(t){return e.clicked(i,a)},className:"TrayButton",id:"trayButton-"+a.pid,style:s},o.a.createElement("img",{alt:"Gerbil",src:r[a.pid],width:"25"})):o.a.createElement("div",null)}}])&&j(n.prototype,r),a&&j(n,a),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");_(e.prototype,t&&t.prototype),t&&_(e,t)}(t,e),t}(r.Component),I=function(e){var t=e.nodes,n=e.selectedNodes,r=e.icons,a=e.showState;return o.a.createElement("div",{id:"Tray"},Object.keys(t).map(function(e,i){return o.a.createElement(R,{key:e,isSelected:t[e].pid in n,icons:r,node:t[e],showState:a})}))},M=n(7);function G(e){return(G="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t){return!t||"object"!==G(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.getPrototypeOf||function(e){return e.__proto__})(e)}var L=960,W=700,F=1,H=M.f().force("charge",M.e().strength(-1e4)).force("center",M.c(L/2,W/2)),J=(M.i(),function(e){e.classed("node",!0).append("circle").attr("r",function(e){if("Spender"===e.constructor.name)return 20}),e.append("svg:image").attr("xlink:href",function(e){return e.gerbil}).attr("x",function(e){return-12.5}).attr("y",function(e){return-12.5}).attr("height",25).attr("width",25)}),Q=function(e){e.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("fill",function(e){return e.color}).attr("stroke",function(e){return e.color}).attr("stroke-width",function(e){return 5})},Y=function(e){e.classed("link",!0).attr("stroke-width",2).attr("stroke","grey")},q=function(e){e.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})},K=function(e){e.classed("message",!0).attr("r",6).attr("fill",function(e){return"#"+e.message.sig.slice(2,8)}).attr("fill-opacity",.5).attr("stroke-width",function(e){return 3}).attr("stroke",function(e){return"#"+e.message.sig.slice(2,8)}).attr("cx",function(e){return U(e.sender).x}).attr("cy",function(e){return U(e.sender).y})},U=function(e){return H.nodes().find(function(t){return t.pid===e})},V=function(e,t){var n=(e.time-e.sentTime)/(e.recvTime-e.sentTime),r=U(e.recipient)[t],o=U(e.sender)[t];return n*(r-o)+o},X=function(e){e.transition().duration(300/F).ease(M.a).attr("cx",function(e){return V(e,"x")}).attr("cy",function(e){return V(e,"y")})},$=function(e){e.selectAll(".node").call(Q),e.selectAll(".link").call(q)},Z=function(e){console.log("Resized"),L=window.innerWidth,W=window.innerHeight,function(e,t,n){e.attr("transform","translate("+(t/2-900)+", "+(n/2-400)+")scale(1.5)"),console.log("Zoomed",t,n)}(e,L,W)},ee=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),z(this,B(t).apply(this,arguments))}var n,r,a;return n=t,(r=[{key:"componentDidMount",value:function(){var e=this;this.d3Graph=M.h(this.viz),H.on("tick",function(){e.d3Graph.call($)}),this.d3Graph.call(Z),M.h(window).on("resize",function(){e.d3Graph.call(Z)})}},{key:"shouldComponentUpdate",value:function(e){var t=this.props.onClick;F=e.speed,this.d3Graph=M.h(this.viz);var n=this.d3Graph.selectAll(".node").data(e.nodes,function(e){return e.pid});n.enter().append("g").call(J).on("click",function(e){t(e,M.b.pageX,M.b.pageY)}),n.exit().remove(),n.call(Q);var r=this.d3Graph.selectAll(".link").data(e.links);r.enter().insert("line",".node").call(Y),r.exit().remove(),r.call(q);var o=this.d3Graph.selectAll(".message").data(e.messages,function(e){return e.message.sig+":"+e.recipient+":"+e.sender}),a=o.enter().insert("circle",".node").call(K);return o.exit().remove(),o.merge(a).call(X),H.nodes(e.nodes).force("link",M.d(e.links).id(function(e){return e.pid}).distance(function(e){return 50}).strength(.3)),!1}},{key:"render",value:function(){var e=this;return o.a.createElement("svg",{width:L,height:W},o.a.createElement("g",{ref:function(t){return e.viz=t}}))}}])&&D(n.prototype,r),a&&D(n,a),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");A(e.prototype,t&&t.prototype),t&&A(e,t)}(t,e),t}(r.Component),te=function(e){var t=e.doubleSpend,n=e.spend,r=e.hide;return o.a.createElement("div",{id:"NodeControls"},o.a.createElement("button",{id:"doubleSpend",onClick:function(){t(),r()}},"Double Spend"),o.a.createElement("button",{id:"spend",onClick:function(){n(),r()}},"Spend"))},ne=n(89),re=n.n(ne);function oe(e){return(oe="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ie(e,t,n[t])})}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ce(e,t){return!t||"object"!==oe(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ue(e){return(ue=Object.getPrototypeOf||function(e){return e.__proto__})(e)}for(var fe=["https://i.imgur.com/Wi9yFXw.png","https://i.imgur.com/U5Y99Rm.png","https://i.imgur.com/NPH4rqg.png","https://i.imgur.com/MptO0GC.png","https://i.imgur.com/yHwPVBF.png","https://i.imgur.com/yvv1MMb.png","https://i.imgur.com/I4Dlkik.png","https://i.imgur.com/jNB8LS6.png"],de={nodes:[],links:[]},pe={},he=0;he<s.nodes.length;he++)s.nodes[he].gerbil=fe[he],pe[s.nodes[he].pid]=fe[he];var me=!0,ye=!1,ve=void 0;try{for(var ge,be=s.nodes[Symbol.iterator]();!(me=(ge=be.next()).done);me=!0){var we=ge.value,ke=!0,Ee=!1,Se=void 0;try{for(var xe,Te=s.network.peers[we.pid][Symbol.iterator]();!(ke=(xe=Te.next()).done);ke=!0){var Oe=xe.value;de.links.push({source:we.pid,target:Oe.pid})}}catch(e){Ee=!0,Se=e}finally{try{ke||null==Te.return||Te.return()}finally{if(Ee)throw Se}}}}catch(e){ye=!0,ve=e}finally{try{me||null==be.return||be.return()}finally{if(ye)throw ve}}r.Component;var Ne=n(15),_e=n(209),je=n.n(_e);n(229);function Pe(e){return(Pe="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Re(e,t,n[t])})}return e}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ge(e,t){return!t||"object"!==Pe(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ae(e){return(Ae=Object.getPrototypeOf||function(e){return e.__proto__})(e)}var De=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Ge(this,Ae(t).call(this,e))).invalidNonceTxs=[],n.pendingTxs=[],n}var n,r,a;return n=t,(r=[{key:"updateInvalidNonceTxs",value:function(){var e=this.invalidNonceTxs,t=this.props.node,n=[],r=[];Object.keys(t.invalidNonceTxs).forEach(function(e,r){Object.keys(t.invalidNonceTxs[e]).forEach(function(r,o){var a=t.invalidNonceTxs[e][r];n.push(a.contents)})});var o=!0,a=!1,i=void 0;try{for(var s,l=function(){var e=s.value;n.find(function(t){return h.a.isEqual(t,e)})&&r.push(e)},c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0)l()}catch(e){a=!0,i=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw i}}for(var u=function(){var e=n[f];r.find(function(t){return h.a.isEqual(e,t)})||r.push(e)},f=0;f<n.length;f++)u();this.invalidNonceTxs=r}},{key:"updatePendingTxs",value:function(){var e=this.props.node,t=[];Object.keys(e.pendingTxs).forEach(function(n,r){var o=!0,a=!1,i=void 0;try{for(var s,l=e.pendingTxs[n][Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value;t.push(Ce({},c,{timeout:n}))}}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}}),this.pendingTxs=t}},{key:"clicked",value:function(e,t){e(t)}},{key:"render",value:function(){var e=this,t=this.props,n=t.node,r=t.icons,a=t.showState;this.updateInvalidNonceTxs(),this.updatePendingTxs();var i=this.pendingTxs.map(function(e,t){var r=Math.floor(100*(n.network.time-e.contents.timestamp)/(e.timeout-e.contents.timestamp));return console.log("percentage:",r,"color: #",e.sigs[0].slice(2,8)),o.a.createElement("tr",{key:t},o.a.createElement("td",null,e.contents.from.substring(0,5)),o.a.createElement("td",null,e.contents.to.substring(0,5)),o.a.createElement("td",null,e.contents.amount),o.a.createElement("td",null,o.a.createElement("div",{style:{width:"50px"}},o.a.createElement(je.a,{percentage:r,strokeWidth:50,key:e.sigs[0],textForPercentage:null,styles:{path:{strokeLinecap:"butt",stroke:"#"+e.sigs[0].slice(2,8)},text:{fill:"#000"}}}))))}),s=o.a.createElement("div",{style:this.pendingTxs.length?{}:{display:"none"}},o.a.createElement("p",null,"Pending Transactions"),o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"From"),o.a.createElement("th",null,"To"),o.a.createElement("th",null,"Amount"),o.a.createElement("th",null,"Timeout")),i))),l=this.invalidNonceTxs.map(function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,e.from.substring(0,5)),o.a.createElement("td",null,e.to.substring(0,5)),o.a.createElement("td",null,e.amount),o.a.createElement("td",null,e.nonce))}),c=o.a.createElement("div",{style:this.invalidNonceTxs.length?{}:{display:"none"}},o.a.createElement("p",null,"Invalid Nonce Transactions"),o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"From"),o.a.createElement("th",null,"To"),o.a.createElement("th",null,"Amount"),o.a.createElement("th",null,"Nonce")),l))),u=Object.keys(n.state).map(function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,e.substring(0,5)),o.a.createElement("td",null,n.state[e].balance),o.a.createElement("td",null,n.state[e].nonce))}),f=Number.parseInt(n.color.slice(1),16),d="white";return(.299*(f>>16&255)+.587*(f>>8&255)+.114*(255&f))/255>.5&&(d="black"),o.a.createElement("div",{className:"Ledger",id:"ledger-"+n.pid,style:{backgroundColor:n.color,color:d}},o.a.createElement("img",{alt:"Gerbil",src:r[n.pid],width:"30"}),o.a.createElement("span",{className:"ledger-title"}," "+n.pid.substring(0,5)),o.a.createElement("button",{className:"LedgerMinimizeButton",onClick:function(t){return e.clicked(a,n)}},o.a.createElement("div",{className:"LedgerMinimizeButtonIcon",style:{backgroundColor:d}})),o.a.createElement("table",null,o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Address"),o.a.createElement("th",null,"Balance"),o.a.createElement("th",null,"Nonce"),o.a.createElement("th",null,"            ")),u)),s,c)}}])&&Me(n.prototype,r),a&&Me(n,a),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Ie(e.prototype,t&&t.prototype),t&&Ie(e,t)}(t,e),t}(r.Component),ze=function(e){var t=e.nodes,n=e.icons,r=e.showState;return o.a.createElement("div",{id:"Ledgers"},Object.keys(t).map(function(e,a){return o.a.createElement(De,{key:e,node:t[e],icons:n,showState:r})}))},Be=function(e){var t=e.show,n=e.handleClose,r=o.a.createElement(E.a,{id:"modal-popover",title:""},"For the technical people: We took the first 6 hexadecimal characters of the Keccak-256 hash of the state and turned it into a hex color!"),a=o.a.createElement(E.a,{id:"modal-popover",title:"Spend"},'Clicking "Spend" will make the selected node generate and propagate a transaction sending $10 to a random node.'),i=o.a.createElement(E.a,{id:"modal-popover",title:"Double Spend"},'Clicking "Double Spend" will make the selected node generate and selectively propagate two transactions each sending $10 to a different peer.',o.a.createElement("br",null)),s=o.a.createElement(E.a,{id:"modal-popover",title:"Resume Transactions"},'Switching on "Resume Transactions" will make all nodes randomly generate and send transactions.',o.a.createElement("br",null));return o.a.createElement(S.a,{show:t,onHide:n},o.a.createElement(S.a.Header,{closeButton:!0},o.a.createElement(S.a.Title,null,"Instructions")),o.a.createElement(S.a.Body,null,o.a.createElement("h4",null,"What is this?"),o.a.createElement("p",null,"This is an interactive network simulation designed as a part of Chapter 2 of "," ",o.a.createElement("a",{href:"https://cryptoeconomics.study/"},"Cryptoeconomics.study"),". To best understand the double spend problem, here is Ethereum Researcher Karl Floersch's explanation in section 2.2 of the course:",o.a.createElement(T.a,{videoId:"k6JVGR7Jx0A",opts:{height:"300",width:"550",playerVars:{autoplay:0}}})),o.a.createElement("h4",null,"How do you send a transaction?"),o.a.createElement("p",null,"Click on a node to either "," ",o.a.createElement(x.a,{overlay:a},o.a.createElement("a",{href:""},"Spend"))," "," or "," ",o.a.createElement(x.a,{overlay:i},o.a.createElement("a",{href:""},"Double Spend"))," ",". You can also toggle the "," ",o.a.createElement(x.a,{overlay:s},o.a.createElement("a",{href:""},"Resume Transactions"))," ","switch."),o.a.createElement("h4",null,"Why is my network graph so small?"),o.a.createElement("p",null,"To increase the size of the network graph, hover over it and scroll upwards. You can also reposition the graph by dragging it around."),o.a.createElement("h4",null,"What do the colors mean?"),o.a.createElement("p",null,"The color of each node "," ",o.a.createElement(x.a,{overlay:r},o.a.createElement("a",{href:""},"represents"))," "," the state of that node's ledger.")),o.a.createElement(S.a.Footer,null,o.a.createElement(l.a,{onClick:n},"Close")))};function Le(e){return(Le="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){return(We=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e,t){return!t||"object"!==Le(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Je(e){return(Je=Object.getPrototypeOf||function(e){return e.__proto__})(e)}var Qe=960,Ye=700,qe=M.f().force("charge",M.e().strength(-1e4)).force("center",M.c(Qe/2,Ye/2)),Ke=(M.i(),function(e){e.classed("node",!0).append("circle").attr("r",function(e){return e.constructor.name,20}),e.append("svg:image").attr("xlink:href",function(e){return e.gerbil}).attr("x",function(e){return-12.5}).attr("y",function(e){return-12.5}).attr("height",25).attr("width",25)}),Ue=function(e){e.attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("fill",function(e){return e.color}).attr("stroke",function(e){return e.color}).attr("stroke-width",function(e){return 5})},Ve=function(e){e.classed("link",!0).attr("stroke-width",2).attr("stroke","grey")},Xe=function(e){e.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})},$e=function(e){e.classed("message",!0).attr("r",6).attr("fill",function(e){return"#"+e.message.sigs[0].slice(2,8)}).attr("fill-opacity",.5).attr("stroke-width",function(e){return 3}).attr("stroke",function(e){return"#"+e.message.sigs[0].slice(2,8)}).attr("cx",function(e){return Ze(e.sender).x}).attr("cy",function(e){return Ze(e.sender).y})},Ze=function(e){return qe.nodes().find(function(t){return t.pid===e})},et=function(e,t){var n=(e.time-e.sentTime)/(e.recvTime-e.sentTime),r=Ze(e.recipient)[t],o=Ze(e.sender)[t];return n*(r-o)+o},tt=function(e){e.transition().duration(500).ease(M.a).attr("cx",function(e){return et(e,"x")}).attr("cy",function(e){return et(e,"y")})},nt=function(e){e.selectAll(".node").call(Ue),e.selectAll(".link").call(Xe)},rt=function(e){console.log("Resized"),Qe=window.innerWidth,Ye=window.innerHeight,function(e,t,n){e.attr("transform","translate("+(t/2-900)+", "+(n/2-400)+")scale(1.5)"),console.log("Zoomed",t,n)}(e,Qe,Ye)},ot=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),He(this,Je(t).apply(this,arguments))}var n,r,a;return n=t,(r=[{key:"componentDidMount",value:function(){var e=this;this.d3Graph=M.h(this.viz),qe.on("tick",function(){e.d3Graph.call(nt)}),this.d3Graph.call(rt),M.h(window).on("resize",function(){e.d3Graph.call(rt)})}},{key:"shouldComponentUpdate",value:function(e){var t=this.props.onClick;this.d3Graph=M.h(this.viz);var n=this.d3Graph.selectAll(".node").data(e.nodes,function(e){return e.pid});n.enter().append("g").call(Ke).on("click",function(e){t(e,M.b.pageX,M.b.pageY)}),n.exit().remove(),n.call(Ue);var r=this.d3Graph.selectAll(".link").data(e.links);r.enter().insert("line",".node").call(Ve),r.exit().remove(),r.call(Xe);var o=this.d3Graph.selectAll(".message").data(e.messages,function(e){return e.message.sigs[0]+":"+e.recipient+":"+e.sender}),a=o.enter().insert("circle",".node").call($e);return o.exit().remove(),o.merge(a).call(tt),qe.nodes(e.nodes).force("link",M.d(e.links).id(function(e){return e.pid}).distance(function(e){return 50}).strength(.3)),!1}},{key:"render",value:function(){var e=this;return o.a.createElement("svg",{width:Qe,height:Ye},o.a.createElement("g",{ref:function(t){return e.viz=t}}))}}])&&Fe(n.prototype,r),a&&Fe(n,a),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");We(e.prototype,t&&t.prototype),t&&We(e,t)}(t,e),t}(r.Component);function at(e){return(at="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){st(e,t,n[t])})}return e}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ut(e,t){return!t||"object"!==at(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ft(e){return(ft=Object.getPrototypeOf||function(e){return e.__proto__})(e)}for(var dt=["https://i.imgur.com/Wi9yFXw.png","https://i.imgur.com/U5Y99Rm.png","https://i.imgur.com/NPH4rqg.png","https://i.imgur.com/MptO0GC.png","https://i.imgur.com/yHwPVBF.png","https://i.imgur.com/yvv1MMb.png","https://i.imgur.com/I4Dlkik.png","https://i.imgur.com/jNB8LS6.png"],pt={nodes:[],links:[]},ht={},mt=0;mt<Ne.nodes.length;mt++)Ne.nodes[mt].gerbil=dt[mt],ht[Ne.nodes[mt].pid]=dt[mt];var yt=!0,vt=!1,gt=void 0;try{for(var bt,wt=Ne.nodes[Symbol.iterator]();!(yt=(bt=wt.next()).done);yt=!0){var kt=bt.value,Et=!0,St=!1,xt=void 0;try{for(var Tt,Ot=Ne.network.peers[kt.pid][Symbol.iterator]();!(Et=(Tt=Ot.next()).done);Et=!0){var Nt=Tt.value;pt.links.push({source:kt.pid,target:Nt.pid})}}catch(e){St=!0,xt=e}finally{try{Et||null==Ot.return||Ot.return()}finally{if(St)throw xt}}}}catch(e){vt=!0,gt=e}finally{try{yt||null==wt.return||wt.return()}finally{if(vt)throw gt}}var _t=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ut(this,ft(t).call(this))).state={selectedNodes:{},history:[],paused:!1,pausedTxs:!0,speed:1,showPopup:!1},e}var n,r,a;return n=t,(r=[{key:"componentDidMount",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=Ne.nodes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;this.showState(a)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}this.timer=M.g(this.tick.bind(this),500/this.state.speed)}},{key:"setMessageQueue",value:function(e){var t=e.messageQueue,n=[];return Object.keys(t).forEach(function(r,o){var a=!0,i=!1,s=void 0;try{for(var l,c=t[r][Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=it({},l.value,{time:e.time});u.recipient=u.recipient.pid,n.push(u)}}catch(e){i=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw s}}}),n}},{key:"tick",value:function(){Ne.network.tick();var e=this.state.history;e.push(re()(Ne.network));var t=this.setMessageQueue(Ne.network);this.setState({history:e,messages:t})}},{key:"getCurrNode",value:function(e){if(Ne.network)return Ne.network.agents.find(function(t){return t.pid===e})}},{key:"onClickNode",value:function(e,t,n){var r=this.state.clickedNode;r&&e.pid===r.pid?this.setState({clickedNode:null}):this.setState({clickedNode:it({},e,{clickedX:t,clickedY:n})})}},{key:"pause",value:function(){var e=this.state,t=e.paused;e.speed;t?this.timer=M.g(this.tick.bind(this),500/this.state.speed):this.timer.stop(),this.setState({paused:!t})}},{key:"pauseTxs",value:function(){this.setState({pausedTxs:!this.state.pausedTxs});var e=!0,t=!1,n=void 0;try{for(var r,o=Ne.nodes[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;a.pausedSpending=!a.pausedSpending}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"rewind",value:function(){var e=this.state.speed;1.5*e>10||(this.setState({speed:e*=1.5}),console.log("rewind",e))}},{key:"fastforward",value:function(){var e=this.state.speed;e/1.5<.005||(this.setState({speed:e/=1.5}),console.log("fastforward",e))}},{key:"stepbackward",value:function(){console.log("stepbackward");var e=this.state.time;e<1||(this.setState({paused:!0}),this.graph.step(e-1),this.getTick(e-1),this.graph.animate())}},{key:"stepforward",value:function(){console.log("stepforward");var e=this.state.time;this.setState({paused:!0}),this.graph.step(e+1),this.getTick(e+1),this.graph.animate()}},{key:"doubleSpend",value:function(e){var t=(e=this.getCurrNode(e.pid)).pid,n=[Ne.network.peers[t][0],Ne.network.peers[t][1]],r=[e.generateTx(n[0].wallet.address,10),e.generateTx(n[1].wallet.address,10)];r[0].isDoubleSpend=!0,r[1].isDoubleSpend=!0,Ne.network.broadcastTo(t,n[0],r[0]),Ne.network.broadcastTo(t,n[1],r[1]),console.log("Double spender:",t,"victims:",n,"spends:",r)}},{key:"spend",value:function(e){var t=this.getCurrNode(e.pid);t.sendTx(t.getRandomReceiver(),10)}},{key:"showState",value:function(e){var t=this.state.selectedNodes;t[e.pid]?delete t[e.pid]:t[e.pid]=e,this.setState({selectedNodes:t})}},{key:"togglePopup",value:function(){this.setState({showPopup:!this.state.showPopup})}},{key:"deselectNode",value:function(){this.setState({clickedNode:null})}},{key:"reset",value:function(){console.log("reset"),this.getTick(0)}},{key:"setSpeed",value:function(e){var t=e/1e3;this.setState({speed:t}),console.log("speeedooo",t)}},{key:"setLatency",value:function(e){var t=e.target.value,n=Math.min(Math.max(parseInt(t),1),10);console.log("latency",t,n)}},{key:"setPacketLoss",value:function(e){var t=e.target.value,n=Math.min(Math.max(parseInt(t),1),20);console.log("packetloss",t,n)}},{key:"render",value:function(){var e=this.state,t=e.clickedNode,n=e.selectedNodes,r=e.messages,a=(e.time,e.paused),i=e.pausedTxs;e.speed;return o.a.createElement("div",{id:"App-container"},o.a.createElement("div",{id:"Network-container"},o.a.createElement("div",{id:"Graph-container"},o.a.createElement(I,{nodes:Ne.nodes,selectedNodes:n,showState:this.showState.bind(this),icons:ht}),o.a.createElement(ze,{nodes:n,showState:this.showState.bind(this),icons:ht}),o.a.createElement(ot,{nodes:Ne.nodes,links:pt.links,messages:r||[],onClick:this.onClickNode.bind(this)}),t?o.a.createElement("div",{style:{position:"absolute",left:t.clickedX-400,top:t.clickedY}},o.a.createElement(te,{doubleSpend:this.doubleSpend.bind(this,t),spend:this.spend.bind(this,t),hide:this.deselectNode.bind(this)})):""),o.a.createElement("div",{id:"Input-container"},o.a.createElement("div",{id:"Controls-container"},o.a.createElement(d,{onPause:this.pause.bind(this),onPauseTxs:this.pauseTxs.bind(this),paused:a,pausedTxs:i,togglePopup:this.togglePopup.bind(this),stepbackward:this.stepbackward.bind(this),stepforward:this.stepforward.bind(this),rewind:this.rewind.bind(this),fastforward:this.fastforward.bind(this),reset:this.reset.bind(this)})))),o.a.createElement(Be,{show:this.state.showPopup,handleClose:this.togglePopup.bind(this)}))}}])&&ct(n.prototype,r),a&&ct(n,a),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");lt(e.prototype,t&&t.prototype),t&&lt(e,t)}(t,e),t}(r.Component),jt=(n(227),function(){return o.a.createElement("div",{className:"App"},o.a.createElement(_t,null))}),Pt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ct(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(o.a.createElement(jt,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/visualizations",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/visualizations","/service-worker.js");Pt?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Ct(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Ct(e)})}}()},230:function(e,t,n){function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.getPrototypeOf||function(e){return e.__proto__})(e)}var l=n(75),c=n(162),u=c.Node,f=c.getTxHash,d=function(e){function t(e,n,r,o){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=i(this,s(t).call(this,e,n,r))).delta=o,a.pendingTxs={},a.seen=[],a.nonce=0,a}var n,r,c;return n=t,(r=[{key:"timeout",value:function(e,t){return e+t*this.delta}},{key:"addressesFromSigs",value:function(e){for(var t=new Set,n=0;n<e.sigs.length;n++){var r=e.sigs[n],o={contents:e.contents,sigs:e.sigs.slice(0,n)},a=f(o),i=l.recover(r,a);if(0===n&&i!==e.contents.from)throw new Error("Invalid first signature!");t.add(i)}return t}},{key:"onReceive",value:function(e){if(!this.seen.includes(e.contents)){var t=this.addressesFromSigs(e);this.network.time>=this.timeout(e.contents.timestamp,t.size)||(this.addToPending(e),e.sigs.push(l.sign(this.wallet.privateKey,f(e))),this.network.broadcast(this.pid,e))}}},{key:"addToPending",value:function(e){this.seen.push(e.contents);var t=this.timeout(e.contents.timestamp,this.network.agents.length);this.pendingTxs[t]||(this.pendingTxs[t]=[]),this.pendingTxs[t].push(e),this.pendingTxs[t].sort(function(e,t){return e.sigs[0]-t.sigs[0]})}},{key:"sendTx",value:function(e,t){var n=this.generateTx(e,t);this.nonce++,this.addToPending(n),this.network.broadcast(this.pid,n)}},{key:"tick",value:function(){var e=this.network.time,t=this.pendingTxs[e];if(t){var n=!0,r=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var s=a.value;this.applyTransaction(s)}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}delete this.pendingTxs[e]}}},{key:"generateTx",value:function(e,t){var n={contents:{type:"send",amount:t,from:this.wallet.address,to:e,nonce:this.nonce,timestamp:this.network.time},sigs:[]};return n.sigs.push(l.sign(this.wallet.privateKey,f(n))),n}},{key:"applyTransaction",value:function(e){if(console.log("~~~~~~~~~APPLY TRANSACTION~~~~~~~~~~",e),e.contents.to in this.state||(this.state[e.contents.to]={balance:0,nonce:0}),e.contents.nonce>this.state[e.contents.from].nonce)return e.contents.from in this.invalidNonceTxs||(this.invalidNonceTxs[e.contents.from]={}),void(this.invalidNonceTxs[e.contents.from][e.contents.nonce]=e);if(e.contents.nonce<this.state[e.contents.from].nonce)console.log("passed nonce tx rejected");else{if("send"!==e.contents.type)throw new Error("Invalid transaction type!");if(this.state[e.contents.from].balance-e.contents.amount<0)throw new Error("Not enough money!");this.state[e.contents.from].balance-=e.contents.amount,this.state[e.contents.to].balance+=e.contents.amount,this.state[e.contents.from].nonce+=1,this.setColor()}}}])&&a(n.prototype,r),c&&a(n,c),function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");o(e.prototype,t&&t.prototype),t&&o(e,t)}(t,e),t}(u);e.exports=d},320:function(e,t){},408:function(e,t){},411:function(e,t){},432:function(e,t){},434:function(e,t){},440:function(e,t,n){},454:function(e,t,n){n(453),e.exports=n(228)}},[[454,0,1]]]);
//# sourceMappingURL=main.6045e543.chunk.js.map